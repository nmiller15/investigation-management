@page
@model CasesIndexModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Cases";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2>Active Cases</h2>
            @if (Model.Cases.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th></th>
                                <th>
                                    <a asp-page="/Cases/Index" 
                                       asp-route-sortColumn="CaseNumber" 
                                       asp-route-sortDirection="@(Model.SortColumn == "CaseNumber" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                       asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                       class="text-decoration-none">
                                        Case # @(Model.SortColumn == "CaseNumber" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                    </a>
                                </th>
                                <th>
                                    <a asp-page="/Cases/Index" 
                                       asp-route-sortColumn="SubjectLastName" 
                                       asp-route-sortDirection="@(Model.SortColumn == "SubjectLastName" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                       asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                       class="text-decoration-none">
                                        Subject @(Model.SortColumn == "SubjectLastName" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                    </a>
                                </th>
                                <th>
                                    <a asp-page="/Cases/Index" 
                                       asp-route-sortColumn="ClientName" 
                                       asp-route-sortDirection="@(Model.SortColumn == "ClientName" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                       asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                       class="text-decoration-none">
                                        Client @(Model.SortColumn == "ClientName" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                    </a>
                                </th>
                                <th>
                                    <a asp-page="/Cases/Index" 
                                       asp-route-sortColumn="CaseTypeShortDescription" 
                                       asp-route-sortDirection="@(Model.SortColumn == "CaseTypeShortDescription" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                       asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                       class="text-decoration-none">
                                        Type @(Model.SortColumn == "CaseTypeShortDescription" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                    </a>
                                </th>
                                <th>
                                    <a asp-page="/Cases/Index" 
                                       asp-route-sortColumn="DateOfReferral" 
                                       asp-route-sortDirection="@(Model.SortColumn == "DateOfReferral" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                       asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                       class="text-decoration-none">
                                        Date Referred @(Model.SortColumn == "DateOfReferral" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                    </a>
                                </th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var c in Model.Cases)
                            {
                                <tr>
                                    <td>@c.CaseKey</td>
                                    <td>@c.CaseNumber</td>
                                    <td>@c.SubjectName</td>
                                    <td>@c.ClientName</td>
                                    <td>@c.CaseTypeCode</td>
                                    <td>@c.DateOfReferral</td>
                                    <td>Active</td>
                                    <td>
                                        <a asp-page="/Cases/Case" 
                                           asp-route-caseKey="@c.CaseKey" 
                                           class="btn btn-sm btn-outline-primary">
                                            View Case
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info" role="alert">
                    No active cases found.
                </div>
            }

            <div class="mt-3">
                @if (!Model.ShowClosedCases)
                {
                    <a asp-page="/Cases/Index" asp-route-ShowClosedCases="true" class="text-muted small">Show Closed Cases</a>
                }
                else
                {
                    <h5 class="mt-4">Closed Cases</h5>
                    <a asp-page="/Cases/Index" asp-route-ShowClosedCases="false" class="text-muted small">Hide</a>
                    
                    @if (Model.ClosedCases.Any())
                    {
                        <div class="table-responsive mt-2">
                            <table class="table table-striped table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th></th>
                                        <th>
                                            <a asp-page="/Cases/Index" 
                                               asp-route-sortColumn="CaseNumber" 
                                               asp-route-sortDirection="@(Model.SortColumn == "CaseNumber" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                               asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                               class="text-decoration-none">
                                                Case # @(Model.SortColumn == "CaseNumber" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                            </a>
                                        </th>
                                        <th>
                                            <a asp-page="/Cases/Index" 
                                               asp-route-sortColumn="SubjectLastName" 
                                               asp-route-sortDirection="@(Model.SortColumn == "SubjectLastName" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                               asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                               class="text-decoration-none">
                                                Subject @(Model.SortColumn == "SubjectLastName" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                            </a>
                                        </th>
                                        <th>
                                            <a asp-page="/Cases/Index" 
                                               asp-route-sortColumn="ClientName" 
                                               asp-route-sortDirection="@(Model.SortColumn == "ClientName" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                               asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                               class="text-decoration-none">
                                                Client @(Model.SortColumn == "ClientName" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                            </a>
                                        </th>
                                        <th>
                                            <a asp-page="/Cases/Index" 
                                               asp-route-sortColumn="CaseTypeShortDescription" 
                                               asp-route-sortDirection="@(Model.SortColumn == "CaseTypeShortDescription" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                               asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                               class="text-decoration-none">
                                                Type @(Model.SortColumn == "CaseTypeShortDescription" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                            </a>
                                        </th>
                                        <th>
                                            <a asp-page="/Cases/Index" 
                                               asp-route-sortColumn="DateOfReferral" 
                                               asp-route-sortDirection="@(Model.SortColumn == "DateOfReferral" && Model.SortDirection == "ASC" ? "DESC" : "ASC")"
                                               asp-route-ShowClosedCases="@Model.ShowClosedCases"
                                               class="text-decoration-none">
                                                Date Referred @(Model.SortColumn == "DateOfReferral" ? (Model.SortDirection == "ASC" ? "↑" : "↓") : "↕")
                                            </a>
                                        </th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var c in Model.ClosedCases)
                                    {
                                        <tr>
                                            <td>@c.CaseKey</td>
                                            <td>@c.CaseNumber</td>
                                            <td>@c.SubjectName</td>
                                            <td>@c.ClientName</td>
                                            <td>@c.CaseTypeCode</td>
                                            <td>@c.DateOfReferral</td>
                                            <td>Inactive</td>
                                            <td>
                                                <a asp-page="/Cases/Profile" 
                                                   asp-route-caseKey="@c.CaseKey" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    View Case
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info mt-2" role="alert">
                            No closed cases found.
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>
